---
outline: deep
---

# @log-reporting/core - V2

**<font color="#ff0000">å€¼å¾—æ³¨æ„: v2 ç‰ˆæœ¬çš„åŒ…ä¸ºâ€œ@log-reporting/coreâ€, è€Œ v1 ç‰ˆæœ¬çš„åŒ…ä¸ºâ€œlog-reportingâ€ï¼› å†™æ³•å‚æ•°ç­‰å®Œå…¨æ˜¯ä¸ä¸€æ ·çš„ï¼Œv2 ç‰ˆæœ¬ä¸ºå…¨æ–°ç‰ˆæœ¬</font>**

**å½“ç„¶ï¼Œ v2 ç‰ˆæœ¬ç”±å†…ç½®çš„`types`ï¼Œ å¦‚æœæ‚¨çš„é¡¹ç›®å› ä¸ºå®‰è£…`@log-reporting/core`è€Œå¯¼è‡´`ts`ç±»å‹æŠ¥é”™ï¼Œé‚£å°±éœ€è¦æ‚¨å®‰è£…`@log-reporting/types`äº†ï¼Œè¿™æ ·å°±å¯ä»¥å®Œå…¨è§£å†³ç±»å‹æŠ¥é”™çš„é—®é¢˜ï¼›**

**å½“å‰ç‰ˆæœ¬ä»…ä»…æ”¯æŒå®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¸æ”¯æŒåœ¨æœåŠ¡ç«¯ä½¿ç”¨**

## ğŸ”ˆ åœ°å€

- [github åœ°å€](https://github.com/wangxiaoze-view/log-repeorting/blob/main/packages/core/README.md)
- [npm åœ°å€](https://www.npmjs.com/package/@log-reporting/core)

## ğŸ”ˆ æ³¨æ„äº‹é¡¹

> æœ¬ç³»ç»Ÿçš„å¼€å‘ç›®çš„å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ºäº†åœ¨éƒ¨åˆ†æƒ…å†µä¸‹æœé›†å‰ç«¯çš„å¼‚å¸¸æ—¥å¿—ï¼Œç”¨äºåˆ†æå¼‚å¸¸æƒ…å†µ;
> å¦‚ï¼šçº¿ä¸Šç¯å¢ƒçš„é¡¹ç›®æˆ‘ä»¬ä¼šå§ä¸€äº›æ—¥å¿—åˆ é™¤ï¼Œå¦‚æœå‰ç«¯æŠ¥é”™é‚£ä¹ˆæ—¥å¿—æ˜¯é¦–é€‰ï¼Œ è¿™æ ·çš„æƒ…å†µæˆ‘ä»¬ä¸çŸ¥é“æ˜¯å“ªé‡Œçš„æŠ¥é”™å¯¼è‡´é¡µé¢å´©æºƒçš„ï¼›
> é‚£ä¹ˆå¼€å‘è¿™æ¬¾å·¥å…·å¸¸è§„æƒ…å†µä¸‹èƒ½è§£å†³å¤§éƒ¨åˆ†çš„é—®é¢˜ï¼›

è¯¥ç‰ˆæœ¬ä¸ºå…¨æ–°ç‰ˆæœ¬, ä¸ä¹‹å‰çš„ç‰ˆæœ¬ä¼šæœ‰å¾ˆå¤§çš„åŒºåˆ«;

## ğŸ”ˆ æ—¥å¿—æœé›†èŒƒå›´

1. èµ„æºï¼šèµ„æºåœ°å€ä¸æ­£ç¡®æˆ–ä¸å­˜åœ¨å¯¼è‡´çš„èµ„æºå¼‚å¸¸
2. ä»£ç ï¼šæœé›†æŠ¥é”™ä¿¡æ¯ï¼Œé¡µé¢çš„å´©æºƒç­‰ç­‰ï¼›
3. è¯·æ±‚ï¼šæˆªè¯·æ±‚å‚æ•°é”™è¯¯ï¼Œè®¿é—®åœ°å€ä¸å­˜åœ¨ï¼Œå¼‚å¸¸æ‹¦
4. é¢å¤–æ·»åŠ åŠŸèƒ½ï¼šæ”¯æŒå½•åˆ¶è‡ªå®šä¹‰æ—¶é—´çš„è§†é¢‘ï¼Œä½†æ˜¯æœ€å¤§æ—¶é—´ä¸èƒ½è¶…è¿‡ 1 åˆ†é’Ÿ;
5. æ”¯æŒæ€§èƒ½ç›‘æ§, ç™½å±æ—¶é—´, é¡µé¢åŠ è½½æ—¶é—´ç­‰ç­‰; <Badge type="tip" text="æ–°ç‰ˆæœ¬æ”¯æŒ" />
6. æ”¯æŒ`pv`é¡µé¢æµè§ˆ, éœ€è¦æ‰‹åŠ¨æäº¤; <Badge type="tip" text="æ–°ç‰ˆæœ¬æ”¯æŒ" />
7. æ”¯æŒ`æ›å…‰`, éœ€è¦æ‰‹åŠ¨è®¾ç½®å¯¹åº”çš„å…ƒç´ (ä»…æ”¯æŒåœ¨å¯æ˜¯åŒºåŸŸå†…); <Badge type="tip" text="æ–°ç‰ˆæœ¬æ”¯æŒ" />

## ğŸ”ˆ å¦‚ä½•ä½¿ç”¨

### ğŸ”ˆjs é¡¹ç›®å¼•å…¥

éœ€è¦å…‹éš†ä¸‹è½½è¯¥é¡¹ç›®, æ‰§è¡Œå‘½ä»¤`pnpm run build`ï¼Œ ä¹‹åä¼šåœ¨æ ¹ç›®å½•`dist`æ–‡ä»¶ä¸‹çœ‹åˆ°æ‰“åŒ…çš„å¯¹åº”çš„æ–‡ä»¶ä¿¡æ¯; æ ¹æ®ä¸åŒå¹³å°å¼•å…¥å³å¯;

ä¸‹é¢ä»£ç ç¤ºä¾‹ä¸ºæµè§ˆå™¨çš„ä½¿ç”¨ï¼š

```js
<script src="dist/index.umd.js"></script>

<script>
  logReportingCore.init({
    // ä¸ŠæŠ¥åœ°å€
    dsn: 'http://localhost:8888/postLog',
    // æ˜¯å¦å¼€å¯è°ƒè¯•
    isDebug: true,
    // æ˜¯å¦æ•è·é”™è¯¯
    isError: true,
    // æ˜¯å¦æ•è·console.error
    isConsoleError: true,
    // æ˜¯å¦æ•è·æ€§èƒ½
    isPerformance: true,
    // æ˜¯å¦æ•è·èµ„æº
    isResource: true,
    // æ˜¯å¦æ•è·è¯·æ±‚
    isXhr: true,
    // å±å¹•å½•åˆ¶
    record: {
      open: true,
      time: 10 * 1000
    },
    // åŠ å¯†æ–¹å¼
    encryptMethod: 'base64',
    // ä¸ŠæŠ¥æ–¹å¼
    method: 'beacon',
    // pvç»Ÿè®¡
    isPv: true,
    // æ›å…‰ç»Ÿè®¡
    isExposure: true
  })
</script>
```

### ğŸ”ˆvue é¡¹ç›®å¼•å…¥

åœ¨`vue`ä¸­ä½¿ç”¨,
`npm install @log-reporting/core` å®‰è£…ä¾èµ–

åœ¨`main.js`ä¸­å¼•å…¥

```js
import { init } from "@log-reporting/core";
init({});
```

æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€è¦å¼€å¯å¯¹åº”çš„é…ç½®ä¿¡æ¯;

## ğŸ”ˆ å…³äº`pvç»Ÿè®¡`ä¸`æ›å…‰ç»Ÿè®¡`

ç›®å‰ä»…ä»…æ”¯æŒæ‰‹åŠ¨ä¸ŠæŠ¥ï¼›

1. `pv`ç»Ÿè®¡ï¼š

```js
import { lestenPv } from "@log-reporting/core";
lestenPv({
	// ç»Ÿè®¡ä¿¡æ¯
	message: "æµ‹è¯•",
	// å…¶ä»–å‚æ•°éƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„
	url: "localhost:8888/getLogData",
	params: { a: 123 },
});

export interface IPv {
	message?: string;
	[k: string]: any;
}
```

2. `æ›å…‰ç»Ÿè®¡`ï¼š

```js
import { lestenExposure } from "@log-reporting/core";
lestenExposure({
	// æ›å…‰å…ƒç´ 
	target: document.querySelector("#btn10"),
	// æ›å…‰ä¿¡æ¯
	message: "æ›å…‰æŒ‰é’®",
	threshold: 0.5,
	// å…¶ä»–å‚æ•°
	params: { a: 123 },
});

export interface IExposure extends IPv {
	threshold?: number;
	target?: any; // æ›å…‰çš„å…ƒç´ 
	params?: Record<string, any>;
	time?: number;
}
```
