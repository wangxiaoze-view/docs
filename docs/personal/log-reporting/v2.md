---
outline: deep
---

# log-reporting - V2

> [**log-reporting** 日志上报服务（V2 版本）](https://github.com/wangxiaoze-view/log-repeorting/blob/main/packages/core/README.md)

**<font color="#ff0000">值得注意: v2 版本的包为“@log-reporting/core”, 而 v1 版本的包为“log-reporting”； 写法参数等完全是不一样的，v2 版本为全新版本</font>**

**当然， v2 版本由内置的`types`， 如果您的项目因为安装`@log-reporting/core`而导致`ts`类型报错，那就需要您安装`@log-reporting/types`了，这样就可以完全解决类型报错的问题；**

**当前版本仅仅支持客户端使用，不支持在服务端使用**

**<font color="#ff4567">文档持续完善中。。。</font>**

## 🔈 注意事项

> 本系统的开发目的很简单，就是为了在部分情况下搜集前端的异常日志，用于分析异常情况;
> 如：线上环境的项目我们会吧一些日志删除，如果前端报错那么日志是首选， 这样的情况我们不知道是哪里的报错导致页面崩溃的；
> 那么开发这款工具常规情况下能解决大部分的问题；

该版本为全新版本, 与之前的版本会有很大的区别;

## 🔈 日志搜集范围

1. 资源：资源地址不正确或不存在导致的资源异常
2. 代码：搜集报错信息，页面的崩溃等等；
3. 请求：截请求参数错误，访问地址不存在，异常拦
4. 额外添加功能：支持录制自定义时间的视频，但是最大时间不能超过 1 分钟;
5. 支持性能监控, 白屏时间, 页面加载时间等等; <Badge type="tip" text="新版本支持" />
6. 支持`pv`页面浏览, 需要手动提交; <Badge type="tip" text="新版本支持" />
7. 支持`曝光`, 需要手动设置对应的元素(仅支持在可是区域内); <Badge type="tip" text="新版本支持" />

## 🔈 如何使用

需要克隆下载该项目, 执行命令`pnpm run build`， 之后会在根目录`dist`文件下看到打包的对应的文件信息; 根据不同平台引入即可;

下面代码示例为浏览器的使用：

```js
<script src="dist/index.umd.js"></script>

<script>
  logReportingCore.init({
    // 上报地址
    dsn: 'http://localhost:8888/postLog',
    // 是否开启调试
    isDebug: true,
    // 是否捕获错误
    isError: true,
    // 是否捕获console.error
    isConsoleError: true,
    // 是否捕获性能
    isPerformance: true,
    // 是否捕获资源
    isResource: true,
    // 是否捕获请求
    isXhr: true,
    // 屏幕录制
    record: {
      open: true,
      time: 10 * 1000
    },
    // 加密方式
    encryptMethod: 'base64',
    // 上报方式
    method: 'beacon',
    // pv统计
    isPv: true,
    // 曝光统计
    isExposure: true
  })
</script>
```

在`vue`中使用,
`npm install @log-reporting/core` 安装依赖

在`main.js`中引入

```js
import { init } from "@log-reporting/core";
init({});
```

根据自己的业务需要开启对应的配置信息;

## 🔈 关于`pv统计`与`曝光统计`

目前仅仅支持手动上报；

1. `pv`统计：

```js
import { lestenPv } from "@log-reporting/core";
lestenPv({
	// 统计信息
	message: "测试",
	// 其他参数都是可以自定义的
	url: "localhost:8888/getLogData",
	params: { a: 123 },
});

export interface IPv {
	message?: string;
	[k: string]: any;
}
```

2. `曝光统计`：

```js
import { lestenExposure } from "@log-reporting/core";
lestenExposure({
	// 曝光元素
	target: document.querySelector("#btn10"),
	// 曝光信息
	message: "曝光按钮",
	threshold: 0.5,
	// 其他参数
	params: { a: 123 },
});

export interface IExposure extends IPv {
	threshold?: number;
	target?: any; // 曝光的元素
	params?: Record<string, any>;
	time?: number;
}
```
